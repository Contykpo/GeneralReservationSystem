@page "/trips/create"

@using GeneralReservationSystem.Application.DTOs

@using GeneralReservationSystem.Application.Entities
@using GeneralReservationSystem.Application.Services.Interfaces

@inject ITripService TripService
@inject NavigationManager NavManager

<TripForm 
    SubmitButtonLabel="Crear Viaje"
    OnValidSubmit="HandleValidSubmit"
    Trip="@newTrip"/>

@code {

    private Trip newTrip = new Trip
    {
        DepartureTime   = DateTime.UtcNow.ToLocalTime(),
        ArrivalTime     = DateTime.UtcNow.ToLocalTime()
    };

    private async Task HandleValidSubmit(Trip trip)
    {
        var newTripDto = new CreateTripDto{
            DepartureStationId  = trip.DepartureStationId,
            ArrivalStationId    = trip.ArrivalStationId,
            DepartureTime       = trip.DepartureTime,
            ArrivalTime         = trip.ArrivalTime,
            AvailableSeats      = trip.AvailableSeats
        };

        await TripService.CreateTripAsync(newTripDto);

        NavManager.NavigateTo("/trips/view");
    }
}