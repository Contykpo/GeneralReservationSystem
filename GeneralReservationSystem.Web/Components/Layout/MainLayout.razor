@inherits LayoutComponentBase


<MudThemeProvider @ref="_mudThemeProvider" @bind-IsDarkMode="_isDarkMode" @rendermode="RenderMode.InteractiveServer" />

<MudDialogProvider />

<MudPopoverProvider />

<MudSnackbarProvider />

<MudLayout>
    <MudAppBar Elevation="1" @rendermode="InteractiveServer">
        <MudText Typo="Typo.h5" Class="ml-3">GRS</MudText>
        <MudSpacer />
        <MudIconButton Edge="Edge.End" OnClick="@((e) => ToggleDrawer())">
            <MudAvatar Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Size="Size.Medium">U</MudAvatar>
        </MudIconButton>
    </MudAppBar>
    <MudDrawer @rendermode="InteractiveServer" @bind-Open="@_open" Breakpoint="@_breakpoint" ClipMode="DrawerClipMode.Always" Anchor="Anchor.Right" Elevation="1" Variant="@DrawerVariant.Temporary">
        <NavMenu />
    </MudDrawer>
    <MudMainContent>
        @Body
    </MudMainContent>
</MudLayout>


@code
{
    private bool _isDarkMode;

    private bool _open = false;

    private Breakpoint _breakpoint = Breakpoint.Lg;

    private MudThemeProvider _mudThemeProvider;

    private void ToggleDrawer()
    {
        _open = !_open;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await _mudThemeProvider.WatchSystemDarkModeAsync(OnSystemDarkModeChanged);
            StateHasChanged();
        }
    }

    private Task OnSystemDarkModeChanged(bool newValue)
    {
        _isDarkMode = newValue;
        StateHasChanged();
        
        return Task.CompletedTask;
    }

}